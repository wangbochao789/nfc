<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>一键打开小红书发布</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
        Helvetica, Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 24px;
      color: #333;
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    }

    h1 {
      font-size: 20px;
      margin-bottom: 12px;
    }

    textarea {
      width: 100%;
      min-height: 160px;
      padding: 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ddd;
      resize: none;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      margin-top: 16px;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background: #ff2442;
      color: #fff;
      cursor: pointer;
    }

    button:active {
      opacity: 0.85;
    }

    .tips {
      margin-top: 16px;
      font-size: 13px;
      color: #666;
      line-height: 1.6;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 60px;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      display: none;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>一键打开小红书发布</h1>

    <textarea id="content">
今日分享：
#好物推荐 #日常记录

这是从我们网站生成的内容，
已经为你准备好啦～
    </textarea>

    <button id="openBtn">打开小红书并发布</button>

    <div class="tips">
      使用说明：
      <br />1. 点击按钮后将自动复制文案
      <br />2. 系统会唤起小红书 App
      <br />3. 点击「＋」 → 长按输入框 → 粘贴 → 发布
    </div>
  </div>

  <div class="toast" id="toast">内容已复制，正在打开小红书…</div>

  <script>
    function showToast(text) {
      const toast = document.getElementById("toast");
      toast.innerText = text;
      toast.style.display = "block";
      setTimeout(() => {
        toast.style.display = "none";
      }, 2000);
    }

    function getOS() {
      const ua = navigator.userAgent.toLowerCase();
      if (/iphone|ipad|ipod/.test(ua)) return "ios";
      if (/android/.test(ua)) return "android";
      return "other";
    }

    async function copyText(text) {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
      } else {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "fixed";
        textarea.style.opacity = "0";
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
      }
    }

    function openXHS() {
      const os = getOS();

      if (os === "ios") {
        window.location.href = "xhsdiscover://";
      } else if (os === "android") {
        // Android上使用Intent scheme唤醒小红书
        // 注意：必须在用户交互事件中直接调用，不能有延迟
        const intentUrl = "intent://discover#Intent;scheme=xhsdiscover;package=com.xingin.xhs;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.xingin.xhs;end";
        
        // 尝试直接跳转
        window.location.href = intentUrl;
      } else {
        alert("请在手机上打开该页面");
      }
    }

    document.getElementById("openBtn").addEventListener("click", async (e) => {
      const content = document.getElementById("content").value;
      const os = getOS();

      try {
        // 先尝试复制内容（不等待完成，因为Android需要立即打开）
        copyText(content).then(() => {
          showToast("内容已复制，正在打开小红书…");
        }).catch(() => {
          showToast("正在打开小红书…");
        });

        // Android上必须在用户交互事件中直接触发，不能有任何延迟
        // 所以立即调用openXHS，不等待复制完成
        if (os === "android") {
          openXHS();
        } else if (os === "ios") {
          // iOS上可以稍等确保复制完成
          setTimeout(() => {
            openXHS();
          }, 100);
        } else {
          openXHS();
        }
      } catch (e) {
        alert("操作失败，请手动复制内容后打开小红书");
      }
    });
  </script>
</body>
</html>
